<HTML>
<HEAD><title> M_Map: A Mapping package for Matlab </title>
</HEAD>
<body bgcolor="FFF5EE">

<h1 align="center">M_Map: User's Guide v1.2 </a></h1>

<hr>
<center> <img src="./mlogo.gif">  </center> <br>



<hr>

<h2> <a name="p1">1. Getting started </a> </h2> <p>

First, get all the files, either as a <a href="http://www.ocgy.ubc.ca/~rich/m_map1.2.zip"> zip archive </a>or a <a href="http://www.ocgy.ubc.ca/~rich/m_map1.2.tar.gz"> gzipped tar-file </a>and unpack them. Now, start up Matlab (version 5 or higher). Make
sure that the toolbox is in your path. This can be done simply by 
<code>cd</code>'ing to the correct directory. 

<p>
Alternatively,
if you have unpacked them into
directory <code>/users/rich/m_map</code> (and <code>/users/rich/m_map/private</code>),
then you can add this to your search path:

<pre>
path(path,'/users/rich/m_map');
</pre>

or

<pre>
addpath /users/rich/m_map
</pre>

To follow along with this document, you would then use a Web-browser to open
<a href="./mapug.html"><code>file:/users/rich/m_map/map.html</code></a>, that
is, this HTML document.

<p>
(Note: you may want to install M_Map as a toolbox accessible to all
users. To do this, unpack the files into $MATLAB/toolbox/m_map, and
add that directory to the list defined in $MATLAB/toolbox/local/pathdef.m).

<p>
To see an example map, try this:

<pre>
m_proj('oblique mercator');
m_coast;
m_grid;
</pre>

This is a line map of the Oregon/British Columbia coast, using an Oblique Mercator projection
(A few more complex maps can be generated by running the demo function <code>m_demo</code>).

<p>

The first line initializes the projection. Defaults are set for the different projection,
so you can easily see what a specific projection looks like, but all projections have a number
of optional parameters as well. To get the same map without using the defaults, you would use

<pre>
m_proj('oblique mercator','longitudes',[-132 -125], ...
       'latitudes',[56 40],'direction','vertical','aspect',.5);
</pre>

The exact meanings of the various options is given in <a href="#p2"> Section 2 </a>. However, notice
that longitudes are specified using a <em> signed </em> notation - East longitudes are positive,
whereas West longitudes are negative (Also note that a decimal degree notation is used, so that
a longitude of 120 30'W is specified as -120.5).

<p>

The second line draws a coastline, using the 1/4 degree database. Coastlines with greater
resolution can be drawn, using your own database (see also <a href="#p7"> Section 7 </a>). <code>m_coast</code>
can be called with various line parameters. For example,

<pre>
m_coast('linewidth',2,'color','r');
</pre>

draws a thicker red coastline. Filled coastlines can also be drawn, using the <code> 'patch' </code>
option (followed by any of the usual PATCH property/value pairs).

<pre>
m_coast('patch',[.7 .7 .7],'edgecolor','none');
</pre>

draws a coastline with a gray fill and no border.

<p>

The third line superimposes a grid. Although there are many possible options that can be used to
customize the appearance of the grid, defaults can always be used (as in the example). 
These options are discussed in <a href="#p4"> Section 4 </a>. You can get a list of the options
using the GET syntax:

<pre>
m_grid get
</pre>

which acts somewhat like the <code> get(gca) </code> syntax for regular plots.

<p>

Finally, suppose you  want to show and label the location of, say, a mooring at 129W, 48 30'N.

<pre>
[X,Y]=m_ll2xy(-129,48.5);
line(X,Y,'marker','square','markersize',4,'color','r');
text(X,Y,' M5','vertical','top');
</pre>

<p>
<code> m_ll2xy </code> (and its inverse <code>m_xy2ll</code>) convert from longitude/latitude coordinates to those of the
projection. Various clipping options can also be specified in converting to projection
coordinates. If you are willing to accept default clipping setting, you can
use the built-in functions  <code> m_line </code> and  <code> m_text </code>:
<pre>
m_line(-129,48.5,'marker','square','markersize',4,'color','r');
m_text(-129,48.5,' M5','vertical','top');
</pre>



<p>
Finally, we may want to alter the grid details slightly. Note that, a given map
must only be initialized once.

<pre>
clf
m_coast('patch',[.7 .7 .7],'edgecolor','none');
m_grid('xlabeldir','end','fontsize',10);
m_line(-129,48.5,'marker','square','markersize',4,'color','r');
m_text(-129,48.5,' M5','vertical','top');
</pre>
<center><img align="center" SRC="exobl2.gif"> 
</center>

<hr>

<h2> <a name="p2"> 2. Specifying projections  </a> </h2> <p>

In order to get a list of the current projections, 
<pre>
m_proj get
</pre>

or 

<pre>
m_proj('get');
</pre>

Which currently return the following list:

<pre>
Available projections are:
     Stereographic
     Orthographic 
     Azimuthal Equal-area
     Azimuthal Equidistant
     Gnomonic
     Satellite
     Albers Equal-Area Conic
     Lambert Conformal Conic
     Mercator
     Miller Cylindrical
     Equidistant Cylindrical
     Oblique Mercator
     Transverse Mercator
     Sinusoidal
     Gall-Peters
</pre>

If you want details about the possible options for any of these projections, add its name
to the above command, e.g.

<pre>
m_proj('get','stereographic');
     'Stereographic'                                   
     <,'lon&lt;gitude>',center_long>                      
     <,'lat&lt;itude>', center_lat>                       
     <,'rad&lt;ius>', ( degrees | [longitude latitude] )>
     <,'rec&lt;tbox>', ( 'on' | 'off' )>                  
</pre>

You can also get details about the current projection. For example, in order to 
see what the default parameters are for the sinusoidal projection, we first initialize it, 
and then use the <code> 'set' </code> option:

<pre>
m_proj('sinusoidal');
m_proj set
Current mapping parameters -
 Projection: Sinusoidal  (function: mp_tmerc)
 longitudes: -90  30 (centered at -30)       
 latitudes: -65  65                          
 Rectangular border: off                     
</pre>

In order to initialize a projection, you usually specify some location parameters that
define the geometry of the projection (longitudinal limits, central parallel, etc.), as well as parameters
that define the extent of the map (whether it is in a rectangular axis, what the border points
are, etc.). These vary slightly from projection to projection.

<p>
Two useful properties for projections are (1) the ability the preserve angles for differentially
small regions, and (2) the ability to preserve area. Projections satisfying the first condition
are called <em> conformal </em>, those satisfying the second are called <em> equal-area </em>.
No projection can be both. Many projections (especially global projections) are neither, instead
an attempt has been made to  aesthetically balance the errors in both conditions. 

<p>
Note: All projections are currently <em> spherical </em> rather than ellipsoidal. It is unlikely
that this will be a problem in normal usage.


<ol>
<h3><li> <a name="p2.1">  Azimuthal projections </h3>

Azimuthal projections are those in which points on the globe are projected onto a flat tangent
plane. Maps using these projections have the property that direction or azimuth from the center
point to all other points is shown correctly. Great circle routes passing through the
central point appear as straight lines (although great circles not passing through
the central point may appear curved).

These maps are usually drawn with circular boundaries.
The following parameters are needed to define an azimuthal projection:

<h4> <code>         <,'lon&lt;gitude>',center_long>  <br>
                    <,'lat&lt;itude>', center_lat>    </code> </h4> 
These parameters define the center point of the map. Maps are aligned so that the specified
longitude is vertical at the map center, with its northern end at the top. 
                  
<h4> <code>      <,'rad&lt;ius>', ( degrees | [longitude latitude] )> </code> </h4> 

This defines the extent of the map. Either an angular distance in degrees can be given (e.g. 90 for
a hemisphere), or the coordinates of a point on the boundary can be specified.

<h4> <code>      <,'rec&lt;tbox>', ( 'on' | 'off' | 'circle' )>     </code> </h4>              

The default is to enclose the map in a circular boundary (chosen using either of the latter
two options), but a rectangular one can also be
specified. However, rectangular maps are usually better drawn using a cylindrical or
conic projection of some sort.
 

<ol>
 <h4> <li>Stereographic </h4>

The stereographic projection is conformal, but not equal-area. This projection is often
used for polar regions. 

 <h4> <li>Orthographic </h4>

This projection is neither equal-area nor conformal, but resembles a perspective view of
the globe.

<h4> <li>Azimuthal Equal-Area </h4>

Sometimes called the Lambert azimuthal equal-area projection, this mapping is equal-area
but not conformal.

<h4> <li>Azimuthal Equidistant </h4>

This projection is neither equal-area nor conformal, but all distances and directions
from the central point are true. 

<h4><li> Gnomonic </h4>

This projection is neither equal-area nor conformal, but all straight lines on the map (not
just those through the center) are great circle routes. There is, however, a great degree of
distortion at the edges of the map, so maximum radii should be kept fairly small - 20 or
30 degrees at most.

<h4><li> Satellite </h4>

This is a perspective view of the earth, as seen by a satellite at a specified altitude. Instead
of specifying a <code>radius</code> for the map, the viewpoint altitude is specified:

<h4> <code>      <,'alt&lt;itude>', altitude_fraction > </code> </h4> 

the numerical value assigned to this property represents the height of the viewpoint in units
of earth radii. For example, a satellite in an orbit of radius 3 earth radii would have an
altitude of 2.

</ol>

 <h3> <li><a name="p2.2"> Cylindrical and Pseudo-cylindrical Projections </h3>

Cylindrical projections are formed by projecting points onto a plane wrapped around the
globe, touching only along some great circle. These  are very useful projections for
showing regions of great lateral extent, and are also commonly used for global maps
of mid-latitude regions only. Also included here are two pseudo-cylindrical projections,
the sinusoidal and Gall-Peters, which have some 
similarities to the cylindrical projections (see below).

<p>
These maps are usually drawn with rectangular boundaries (with the exception of the
sinusoidal and sometimes the transverse mercator).


<ol>
 <h4><li>  Mercator </h4>

This is a conformal map, based on a tangent cylinder wrapped around the equator. Straight
lines on this projection are rhumb lines (i.e. the track followed by a course of constant
bearing). The following properties affect this projection:

<h4> <code>         <,'lon&lt;gitude>',( [min max] | center)>  </code> </h4>

Either longitude limits can be set, or a central longitude defined implying a global map.

 <h4> <code>        <,'lat&lt;itude>', ( maxlat | [min max])>    </code> </h4> 

Latitude limits are most usually the same in both N and S latitude, and can be specified with
a single value, but (if desired) unequal limits can also be used.

 <h4> <li>Miller Cylindrical </h4>

This projection is neither equal-area nor conformal, but "looks nice" for world maps. Properties
are the same as for the Mercator, above.

<h4> <li> Equidistant cylindrical </h4>

This projection is neither equal-area nor conformal. It consists of equally-spaced latitude
and longitude lines, and is very often used for quick plotting of data. It is included here
simply so that such maps can take advantage of the grid generation routines. Also known
as the Plate Carree. Properties
are the same as for the Mercator, above.


 <h4><li> Oblique Mercator </h4>

The oblique mercator arises when the great circle of tangency is arbitrary. This is a useful
projection for, e.g., long coastlines or other awkwardly shaped or aligned regions. It
is conformal but not equal area.
The following properties govern this projection:

<h4> <code>         <,'lon&lt;gitude>',[ G1 G2 ]> <br>
                    <,'lat&lt;itude>', [ L1 L2 ]>  </code> </h4>

Two points specify a great circle, and thus the limits of this map (it is assumed that
the region near the shortest of the two arcs is desired). The 2 points are (G1,L1) and (G2,L2).

<h4> <code>     <,'asp&lt;ect>',value>   </code> </h4>  

This specifies the size of the map in the direction perpendicular to the great circle of tangency,
as a proportion of the length shown. An aspect ratio of 1 results in a square map, smaller numbers
result in skinnier maps. Aspect ratios >1 are possible, but not recommended.

<h4> <code>    <,'dir&lt;ection>',( 'horizontal' | 'vertical' ) </code> </h4>  

This specifies whether the great circle of tangency will be horizontal on the page (for making
short wide maps), or vertical (for tall thin maps).


 <h4><li>  Transverse Mercator </h4>

The Transverse Mercator is a special case of the oblique mercator when the great circle of tangency
lies along a meridian of longitude, and is therefore conformal. 
It is often used for large-scale maps and charts.
The following properties govern this projection:

<h4> <code>           <,'lon&lt;gitude>',[min max]>   <br>   
     <,'lat&lt;itude>',[min max]>    </code> </h4>
    
These specify the limits of the map.

<h4> <code>       <,'clo&lt;ngitude>',value>    </code> </h4> 
     
Although it makes most sense in general to specify the central meridian as the meridian of tangency
(this is the default), certain map classification systems (noteably UTM) use only a fixed
set of central longitudes, which may not be in the map center.

<h4> <code>       <,'rec&lt;tbox>', ( 'on' | 'off' )> </code> </h4>

The map limits can either be based on latitude/longitude (the default), or the map boundaries
can form an exact rectangle. The difference is small for large-scale maps. 


Note: Although this projection is similar to the Universal Transverse Mercator (UTM) projection,
the latter is actually ellipsoidal in nature.


 <h4><li> Sinusoidal </h4>

This projection is usually called "pseudo-cylindrical" since parallels of latitude
appear
as straight lines, similar to their appearance in cylindrical projections tangent to the
equator. However, meridians curve together in this projection in a sinusoidal way (hence
the name), making this map equal-area.

 <h4><li> Gall-Peters </h4>

Parallels of latitude and meridians both appear as straight lines, but the vertical scale
is distorted so that area is preserved. This is useful for tropical areas, but
the distortion in polar areas is extreme.


</ol>

<h3> <li>   <a name="p2.3">Conic Projections </h3>

Conic projections result from projecting onto a cone wrapped around the sphere. The vertex
of the cone lies on the rotational axis of the sphere. The cone is either
tangent at a single latitude, or can intersect the sphere at two separated latitudes.
It is a useful projection for mid-latitude areas of large east-west extent.
The following properties affect these projections:

<h4> <code>           <,'lon&lt;gitude>',[min max]>   <br>   
     <,'lat&lt;itude>',[min max]>    </code> </h4>
    
These specify the limits of the map.

<h4> <code>       <,'clo&lt;ngitude>',value>    </code> </h4> 
     
The central longitude appears as a vertical on the page. The default value is the mean
longitude, although it may be set to any value (even one outside the limits).

<h4> <code>     <,'par&lt;allels>',[lat1 lat2]>   </code> </h4>

The standard parallels can be specified. Either one or two parallels can be given, the default
is a single parallel at the mean latitude

<h4> <code>       <,'rec&lt;tbox>', ( 'on' | 'off' )> </code> </h4>

The map limits can either be based on latitude/longitude (the default), or the map boundaries
can form an exact rectangle which contain the given limits. Unless the region being mapped is
small, it is best to leave this <code> 'off' </code>.

<ol>
  <h4><li> Albers Equal-Area Conic </h4>

This projection is equal-area, but not conformal

  <h4><li> Lambert Conformal Conic </h4>

This projection is  conformal, but not equal-area.
</ol>


</ol>
<h3>   <a name="p2.4">4. Yeah, but which projection should I use?</h3>

Well, it depends really on how large an area you are mapping. Usually, maps
of the whole world are Mercator, although often the Miller Cylindrical
projection looks better because it doesn't emphasize the polar areas as much.
It's probably not a good idea to use these projections for maps that don't
have the equator somewhere near the middle. 

<p>
If you are plotting something with a large north/south extent, but not
very wide (say, North and South America, or the North and South Atlantic), then 
the Sinusoidal projection
will look pretty good. Another choice is the Transverse Mercator, although
that is usually used only for very large-scale maps.

<p> 
For smaller areas within one hemisphere or other (say, Australia, the
United States, the Mediterranean, the North Atlantic) you might pick a conic
projection. The differences between the two available conic projections
are subtle, and if you don't know much about projections it probably won't
make much difference which one you use.

<p>
If you get smaller than that, it probably doesn't matter a whole lot which
projection you use. One projection I find useful in many cases is the Oblique
Mercator, since you can align it along a long (but narrow) coastal area.
If longitude/latitude map limits are OK, use a Transverse Mercator or Conic
Projection.

<p>
Polar areas are traditionally mapped using a Stereographic projection, since
for some reason it looks nice to have a "bullseye" pattern of latitude lines.

<p>
If you want to get a quick idea of what any projection looks like, Default
parameters for all functions are set for a "typical" usage, so if you
want to get a quick idea of what any projection looks like, you can
do so without having to figure out a lot of numerical values:

<pre>
m_proj('stereographic');  % Example for stereographic projection
m_coast;
m_grid;
</pre>

<p>

<hr>

<h2> <a name="p3"> 3. Coastlines and Bathymetry </a> </h2> <p>

M_Map includes two fairly simple databases for coastlines and global elevation data.
Highly-detailed databases are not included in this release because they
are a) extremely large and b) extremely
time-consuming to process (loops are inherently involved). If more detailed maps
are required, <a href="#p7"> section 7 </a> and <a href="#p8"> section 8 </a>
give instructions on how to proceed.

<h2> <a name="p3.1"> 3.1 Coastline options  </a> </h2> <p>

M_Map includes a 1/4 degree resolution coastline database. This is suitable for maps
covering large portions of the globe, but is noticeably coarse for many large-scale
applications. Users not satisfied with their regional map are directed to
 <a href="#p7"> section 7 </a> for more information on creating and using high-resolution
coastlines.

The M_Map database is accessed using the <code> m_coast </code> function. Coastlines
can be drawn as simple lines, using

<pre>
m_coast('line', ...optional line arguments );
</pre>

or

<pre>
m_coast( optional line arguments );
</pre>

where the optional arguments are all the standard arguments for specifying line style, width,
color, etc.

Coastlines can also be drawn as filled patches using

<pre>
m_coast('patch', ...optional patch arguments );
</pre>

where the optional trailing arguments are the standard patch properties. For example,

<pre>
m_coast('patch',[.7 .7 .7],'edgecolor','g');
</pre>

draws gray land, outlined in green. 

When patches are being drawn, lakes and inland seas are given the axes background colour.

<p>
Note that line coastlines are usually drawn rather rapidly. Filled coastlines take considerably
more time to generate (because map limits are not necessarily rectangular, clipping must
be accomplished in m-files).

<h2> <a name="p3.2"> 3.2 Topography/Bathymetry options  </a> </h2> <p>

M_Map can access a 1-degree resolution global elevation database (actually, this database is
is included in the Matlab distribution, used by of <code>$MATLAB/toolbox/matlab/demos/earthmap.m</code>).
A contour map of elevations at default levels can be drawn using

<pre>
m_elev;
</pre>

Different levels can also be specified:

<pre>
m_elev('contour',LEVELS, optional contour arguments);
</pre>

For example, if you want all the contours to be dark blue, use:

<pre>
m_elev('contour',LEVELS,'edgecolor','b');
</pre>


Filled contours are also possible:

<pre>
m_elev('contourf',LEVELS, optional contourf arguments);
</pre>

Finally, if you want to simply extract the elevation data for your own purposes,

<pre>
[Z,LONG,LAT]=m_elev([LONG_MIN LONG_MAX LAT_MIN LAT_MAX]);
</pre>

returns rectangular matrices for depths Z at locations LONG,LAT.

<hr>

<h2> <a name="p4"> 4. Customizing axes  </a> </h2> <p>


<h3> <a name="p4.1">4.1 Grid lines and labels </h3>

In order to get the perfect grid, you may want to experiment with different grid options. Two
functions are useful here, M_GRID which draws a grid, and M_UNGRID which erases the current
grid (but leaves all coastlines and user-specified data alone). Try

<pre>
m_proj('Lambert');
m_coast;
m_grid;
</pre>

to get a Lambert conic projection of North America. Now try

<pre>
m_ungrid
</pre>

The coastline is still there, but the grid has disappeared and the axes shows raw X/Y projection
coordinates. Now, try this:

<pre>
m_grid('xtick',10,'tickdir','out','yaxislocation','right','fontsize',7);
</pre>

The various options that can be changed are:

<h4> <code> 'box',( 'on' | 'off' | 'fancy' ) </code> </h4>

This specifies whether or not an outline box is drawn. Three types of outline
boxes are available: <code>'on'</code>, the default, is a a simple line. Two
types of fancy outline boxes are available. If <code>'tickdir'</code> is <code>'in'</code>,
then alternating black and white patches are made (see <a href="../map.html#e2">example 2</a>).
If <code>'tickdir'</code> is set to <code>'out'</code>, then a more complex line pattern
is drawn (see <a href="../map.html#e6">example 6</a>).
Fancy boxes are in general only available for maps bounded
by lat/long limits (i.e. not for azimuthal projections), but if this option is
chosen inappropriately a warning message is issued.


<h4> <code>      'xtick',( num | [value1 value2 ...])</code> </h4>

This specifies the number/location of the longitude grid. If a single number is specified,
grid lines/values are drawn for approximately that number of equally-spaced locations (the
number is only approximate because the M_GRID attempts to find "nice" intervals, i.e. it
rounds to even increments). Exact locations can be specified by using a vector of
location values. There is an analagous <code> 'ytick' </code> property.

<h4> <code>      'xticklabels',[label1;label2 ...]</code> </h4>

Special labels can be specified. Labels can either be numerical values (which are then formatted
by M_GRID), or string values which are used without change. There is an analagous 
<code> 'yticklabels' </code> property

<h4> <code>      'xlabeldir', ( 'middle' | 'end' )</code> </h4>

Longitude labels are either middled onto the ends of their prespective grid lines (and drawn
perpendicular to those lines), or are drawn extending outwards fro the ends of those lines.
There is an analagous 
<code> 'ylabeldir' </code> property.

<h4> <code>      'ticklen',value</code> </h4>

Specifies the length of tickmarks (as a fraction of plot width)

<h4> <code>      'tickdir',( 'in' | 'out' )</code> </h4>

Specifies whether tickmarks point inwards or outwards. If <code>'box'</code> is
set to <code>'fancy'</code>, this specifies the form of the fancy outline box.

 <h4> <code>     'color',colorspec <br>
      'linewidth', value <br>
  'linestyle', ( linespec | 'none' ) <br>
   'fontsize',value  <br>
    'fontname',name</code> </h4>

Specify various line/text properties for the grid and its labels.

<h4> <code>      'XaxisLocation',( 'bottom' | 'middle' | 'top' ) </code></h4>

Specifies where the X-axis will be drawn, either at the bottom (southermost) end, at
the top (northernmost) end, or in the middle.

<h4> <code>        'YaxisLocation',( 'left' | 'middle' | 'right' ) </code> </h4>

Specifies where the Y-axis will be drawn, either at the left (westernmostmost) end, at
the right (easternmost) end, or in the middle.

<h3> <a name="p4.2">4.2 Titles and x/ylabels </h3>

Titles and x/ylabels can be added to maps using the <code>title</code> and 
<code>x/ylabel</code> functions in the usual way (this is a change from v1.0 in which
the 'visible' property had
to be explicitly set to 'on'; this is now done within m_grid).


<hr>

<h2> <a name="p5">5.  Adding your own data  </a> </h2> <p>

The purpose of this package is to allow you to map your own data! Once a suitable
grid and (possibly) a coastline have been chosen, raw longitude/latitude coordinates
must be converted to projection coordinates before being plotted. Similarly, an
program using, say, <code>ginput</code> to select points will have to convert projection coordinates
back to longitude/latitude. 

<p>
Once the conversion of coordinates has taken place, plotting of data using
any of the standard Matlab functions (line, patch, pcolor, etc.) proceeds as usual. In v1.2,
a number of primitive functions have been added to take care of the coordinate conversion
invisibly.

<p>
Caution: One problem that sometimes occurs is that data does not appear on the plot due to
ambiguities in longitude values. For example, if plot longitude limits are [-180 180],
a point with a longitude of, say, 200, may not appear in cylindrical and conic projections. 
This is not a bug. Handling the clipping in "wrapped around" curves requires
adding points (rather than just moving them) and is therefore incompatible with
various other requirements (such as keeping input and output matrices the same size
in the conversion routines described below).  

<h3> <a name="p5.1"> 5.1 Converting  longitude/latitude to projection coordinates </h3>

The following command converts longitude/latitude coordinates to projection coordinates. 

<pre>
[X,Y]=m_ll2xy(LONG,LAT, ...optional clipping arguments )
</pre>

where LONG, LAT, X, and Y are matrices of the same size. The possible clipping arguments are


<h4> <code>     'clip','on' </code> </h4>


This is the default. Columns of LONG and LAT are assumed to form lines, and these are clipped
to the map limits. The first point outside the map is therefore moved to the map edge,
and all other points are converted the NaN.


<h4> <code>     'clip','off' </code> </h4>


No clipping is performed. This is sometimes useful for debugging purposes.


<h4> <code>     'clip','point' </code> </h4>


Points are tested against the map limits. Those outside the limits are converted to NaN,
those inside are converted to projection coordinates. No points are moved. This option
is useful for point data (such as station locations).

<h4> <code>     'clip','patch' </code> </h4>


Points are tested against the map limits. Those outside the limits changed into a point exactly
on the limits. Those inside are converted to projection coordinates. This option
may be useful when trying to draw patches, however it probably won't work well.

<h3> <a name="p5.2"> 5.2 Converting projection coordinates to longitude/latitude </h3>

Conversion from projection coordinates to longitude/latitude is straightforward:

<pre>
[LONG,LAT]=m_ll2xy(X,Y)
</pre>

There are no options.

<h3> <a name="p5.3"> 5.3 Drawing lines, text, arrows, and contours </h3>

If you do not need to reuse the map coordinates produced by <code> m_ll2xy </code>
as decribed above,  
calls 
to <code> line, text, quiver,
contour, and contourf </code> can be replaced with M_Map equivalents that recognize
lontgitude/latitude coordinates by prepending "m_" to the function name. For example,

<pre>
m_line(LONG,LAT,...line properties)
m_quiver(LONG,LAT,U,V,S)
m_text(LONG,LAT,'string')
</pre>


Each of these functions will handle the coordinate conversion internally, and will 
return a vector of handles to the graphic objects if desired. The
only difference between these functions and the standard Matlab functions is that the first two
arguments MUST be longitude and latitude. 

<p>
Data gridded in longitude and latitude can also be contoured:

<pre>
m_contour(LONG,LAT,VALUES)
m_contourf(LONG,LAT,VALUES)
</pre>

Again, these functions will return handles to graphics objects, allowing (for example) the drawing of
labelled contours:

<pre>
[cs,h]=m_contour(LONG,LAT,VALUES)
clabel(cs,h,'fontsize',6);
</pre>

<p>
Fancy arrows (i.e. with width, head shape, and colour specifications) can be generated using
<code> m_vec.m </code>. See the on-line help for more details about the use of <code>m_vec</code>.

<hr>

<h2> <a name="p6">6.  More complex plots  </a> </h2> <p>

For ideas on how to make more complex plots, see the <a href="../map.html#examples">Examples</a>.
These plots are also included in the function <code>m_demo</code>.

<hr>

<h2> <a name="p7">7.  Adding your own coastlines  </a> </h2> <p>

If you are interested in a particular area and want a higher-resolution coastline than
that used by <code>m_coast</code>, the best procedure is to

<ol>
<li> Get a subset of points from some high-resolution database, and
<li> convert to screen coordinates using <code>m_ll2xy</code>, and plot.
</ol>

One place where high-resolution coastline data can be obtained is 
<a href="http://crusty.er.usgs.gov/coast/getcoast.html"> The Coastline Extractor</a>.
Follow the instructions there to get coastline data in a matlab-readable file,
and download to your computer. If the file is saved as "coast.dat", you can
plot it (as lines) using the following:

<pre>
load coast.dat
m_line(coast(:,1),coast(:,2));
</pre>

Filled coastlines will require more work. You should first read the instructions there 
on joining the coastline data into continuous segments. If you are lucky,
(i.e. no lakes or anything else), you <em>may</em> achieve success with

<pre>
load coast.dat
[X,Y]=m_ll2xy(coast(:,1),coast(:,2),'clip','patch');
k=[find(isnan(X(:,1)))];
for i=1:length(k)-1,
    x=coast([k(i)+1:(k(i+1)-1) k(i)+1],1);
    y=coast([k(i)+1:(k(i+1)-1) k(i)+1],2);
    patch(x,y,'r');
end;
</pre>

If this does not work, read the comments in <code>m_coast</code>, orient the curves
in the desired fashion, and modify <code>m_coast</code> to load your own data 
instead of <code>m_coasts.mat</code>.



<hr>

<h2> <a name="p8">8.  Adding your own topography/bathymetry  </a> </h2> <p>

A number of global and regional topography databases are available at
<a href="http://www.scd.ucar.edu/dss/index.html"> NCAR </a>. Several are
available for free from 
<a href="http://www.scd.ucar.edu/dss/catalogs/free.html"> their ftp site</a>.

<p>
As long as the data is stored in a mat-file as a rectangular matrix in longitude/latitude,
modification of <code>m_elev</code> to make use this data should be straightforward.
<hr>

<h2> <a name="p9">9. Using TerrainBase 5-minute global bathymetry/topography   </a> </h2> <p>

For many purposes the elevation database accessed by M_Map provides adequate
resolution. However, there are also many cases when more detail is desired. 
I have not included a higher-resolution database because
it would greatly increase the size of the package. However, v1.2 includes m-files
to access and plot a popular global 5-minute bathymetry/topography database,
after a few minutes of work.

<p>
This section provides instructions on how to download 
<a href="http://www.scd.ucar.edu/dss/datasets/ds759.2.html"> TerrainBase</a>, and convert
it from a 56Mb ASCII file to a 18Mb binary file using <code> m_tba2b.m</code>. It
is then straightforward to access and plot bathymetry from this file using 
<code> m_tbase.m</code>, which is in every way functionally identical to 
<code>m_elev</code> (see Section <a href="#p3.2">3.2</a>). 

<p>
TerrainBase is also available on CDrom, and is also
commonly stored in netcdf (or other) binary format somewhere on many academic networks. If
you modify <code> m_tbase.m </code> to access data from one of these
sources, let me know!

<p>
How to install TerrainBase:
<ol>
<li> get and uncompress the tbase.Z file from 
<a href="ftp://ncardata.ucar.edu/datasets/ds759.2/tbase.Z"> ftp://ncardata.ucar.edu/datasets/ds759.2/tbase.Z </a> into the m_map directory.
<p>
<li> Run  <code> m_tba2b('PATHNAME') </code> to store the resulting 18Mb binary
 file as <code> PATHNAME/tbase.int</code>.
<p>
<li> Delete the original ASCII file <code>tbase</code>.
<p>
<li> Edit the <code>PATHNAME</code> setting in <code>m_tbase</code> to 
point to the location of this file.

</ol>

That's it! Test things out with this map of the western mediterranean:
<pre>
m_proj('lambert','lon',[-10 20],'lat',[33 48]);
m_tbase('contourf');
m_grid('linestyle','none','tickdir','out','linewidth',3);
</pre>
<center> <img src="./extbase.gif">  </center> <br>



<hr>

<h2> <a name="p10">10. M_Map toolbox contents and description   </a> </h2> <p>


<ol>
<li>  Contents.m - toolbox contents
<li>  m_demo.m  - demonstrates a few maps.
</ol>

  User-callable functions
<ol>
<li>    m_proj.m   - initializes projections
<li>    m_grid.m   - draws grids
<p>
<li>    m_ungrid.m - erases grids (if you want to change grid parameters)
<p>

<li>    m_coast.m  - draws a coastline
<li>    m_elev.m   - draws elevation data
<li>    m_tbase.m   - draws elevation data from high-resolution database
<p>

<li>    m_ll2xy.m  - converts from long/lat to map coordinates
<li>    m_xy2ll.m  - converts from map coordinates to long/lat
<p>
<li>    m_line.m   - draws line data in map coords
<li>    m_text.m   - adds text data in map coords
<li>    m_quiver   - draws arrows for vector data
<li>    m_contour  - draws contour lines for gridded data
<li>    m_contourf - draws filled contours
<p>
<li>    m_tba2b.m   - used in installing high-resolution elevation database.
<p>
<li>    m_vec.m     - fancy arrows
</ol>

  Internal functions (not meant to be user-callable)

<ol>
<li>    private/mp_azim.m  - azimuthal projections
<li>    private/mp_cyl.m   - cylindrical projections (equatorial)
<li>    private/mp_conic.m - conic projections
<li>    private/mp_tmerc.m - transverse cylindrical projections
<li>    private/mp_omerc.m - oblique cylindrical projection
<p>

<li>    private/mu_util.m   - various utility routines
<li>    private/clabel.m - patched version of clabel 
                         (matlab v5.1 version does not contain
                         capabilities for different text properties).    

<li>    private/contourf.m  - patched version of contourf 
(matlab v5.0 version works incorrectly, v5.1 OK) 
<p>
<li>    private/m_coasts.mat - coastline data
</ol>

 HTML Documentation
<ol>
<li>  map.html  - documentation intro
<li>  private/mapug.html - users guide
<li>  various .gif - examples.
</ol>

<hr>

<h2> <a name="p11">11. Known Problems and Bugs   </a> </h2> <p>

<ol> 
<li>  Running M_Map on a PC with Matlab5.1 can sometimes produce a lot of

<pre>
> Warning: Divide by zero.
</pre>

messages. This is due to a bug in Matlab (actually due to the compiler TMW used) that 
results in an incorrect warning flag being set
when dividing some numbers by NaN. You can safely ignore these errors and
wait for v5.2
<p>
<li> If plotted data is coloured white, this will be changed to black in the postscript
output. This is due to the workings of the <code>print</code> command. 
In order to avoid this, set the figure background to white, i.e.

<pre>
set(gcf,'color','white')
</pre>




</ol>


<h2> <a name="p11">12. Changes since last release   </a> </h2> <p>

<ol>
<li> some v1.1 and 1.2 users reported problems with layers appearing in incorrect order (usually PC
users). This was due to some kind of conflict with the map background patch. I have changed the way
in which this is specified and layering appears to work correctly for all machines. Let me know
if you have problems with this - emailing me your version of m_grid will help.

<p>
<li> A small bug in m_contourf resulted in patches extending beyond the map edge; this has now been
fixed.

<p>
<li> Addition of E. Firing's fancy vector code (m_vec.m).

<p>
<li> Small changes in the auto-gridding so that edge limits are not automatically
labelled (this makes things look a little cleaner).

<p>
<li> Fancy box outline code added for really spiffy maps.

</ol>

<hr>

<a href="../map.html"> Back to home page </a>


<hr>

<I> Last changed 20/May/1998. Questions and comments to 
  <a href="mailto:rich@ocgy.ubc.ca">rich@ocgy.ubc.ca</a>
 </I>
